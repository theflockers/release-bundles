apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  annotations:
    tekton.dev/pipelines.minVersion: 0.12.1
    tekton.dev/tags: release
  generation: 26
  labels:
    app.kubernetes.io/version: "0.5"
  name: deploy-release
  namespace: managed-release-team-tenant
spec:
  description: Tekton pipeline to verify Snapshot prior to Deployment
  params:
  - description: The namespaced name (namespace/name) of the Release custom resource
      initiating this pipeline execution
    name: release
    type: string
  - description: The namespaced name (namespace/name) of the releasePlan
    name: releaseplan
    type: string
  - description: The namespaced name (namespace/name) of the releasePlanAdmission
    name: releaseplanadmission
    type: string
  - description: The namespaced name (namespace/name) of the releaseStrategy
    name: releasestrategy
    type: string
  - description: The namespaced name (namespace/name) of the snapshot
    name: snapshot
    type: string
  - description: JSON representation of the EnterpriseContractPolicy
    name: enterpriseContractPolicy
    type: string
  - description: The location of the bundle containing the verify-enterprise-contract
      task
    name: verify_ec_task_bundle
    type: string
  tasks:
  - name: collect-data
    params:
    - name: release
      value: $(params.release)
    - name: releaseplan
      value: $(params.releaseplan)
    - name: releaseplanadmission
      value: $(params.releaseplanadmission)
    - name: releasestrategy
      value: $(params.releasestrategy)
    - name: snapshot
      value: $(params.snapshot)
    taskRef:
      kind: Task
      params:
      - name: url
        value: https://github.com/redhat-appstudio/release-service-catalog.git
      - name: revision
        value: main
      - name: pathInRepo
        value: tasks/collect-data/collect-data.yaml
      resolver: git
    workspaces:
    - name: data
      workspace: release-workspace
  - name: run-file-updates
    params:
    - name: fileUpdatesPath
      value: extra_data.json
    - name: jsonKey
      value: .fileUpdates
    runAfter:
    - collect-data
    taskRef:
      kind: Task
      params:
      - name: url
        value: https://github.com/theflockers/release-service-bundles.git
      - name: revision
        value: rhtaprel_216
      - name: pathInRepo
        value: tasks/run-file-updates/run-file-updates.yaml
      resolver: git
    workspaces:
    - name: data
      workspace: release-workspace
  workspaces:
  - name: release-workspace
